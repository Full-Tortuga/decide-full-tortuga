{% extends "base.html" %}
{% load i18n static %}

{% block extrahead %}
    <link type="text/css" rel="stylesheet"
         href="https://unpkg.com/bootstrap/dist/css/bootstrap.min.css" />
    <link type="text/css" rel="stylesheet"
         href="https://unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.css" />
    <link type="text/css" rel="stylesheet" href="{% static "booth/style.css" %}" />
{% endblock %}

{% block content %}
    <div id="app-visualizer">
        <!-- Navbar -->
        <b-navbar type="dark" variant="secondary">
            <b-navbar-brand tag="h1">Decide</b-navbar-brand>
        </b-navbar>

        <div class="voting container">
            <h1>{{voting.0.id}} - {{voting.0.name}}</h1>

            {%if voting.0.start_date == null %}
                <h2>Votaci贸n no comenzada</h2>
            {%elif voting.0.end_date == null %}
                <h2>Votaci贸n en curso</h2>
            {% else %}
            <div v-else>
                <h2 class="heading">Resultados:</h2>

                <table class="table table-bordered table-striped">
                    <thead>
                        <tr>
                            <th>Opci贸n</th>
                            <th>Puntuaci贸n</th>
                            <th>Votos</th>
                        </tr>
                    </thead>
                    <tbody>
                        {%for opt in voting.1%}
                        <tr>
                            <th>{{opt.option}}</th>
                            <td>{{opt.postproc}}</td>
                            <td class="text-muted">{{opt.votes}}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
             <!---   <a href="#">Descargar datos</a>-->
            </div>
            {% endif %}
        </div>
        <chart></chart>
    </div>
        

{% endblock %}

{% block extrabody %}
    <!-- Vuejs -->
    <script src="https://unpkg.com/vue"></script>
    <script src="https://unpkg.com/babel-polyfill@latest/dist/polyfill.min.js"></script>
    <script src="https://unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.js"></script>

    <!-- Chart.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.1/Chart.min.js"></script>

    <!-- Vue Chart -->
    <script src="https://unpkg.com/vue-chartjs/dist/vue-chartjs.min.js"></script>

    <!-- Graphics -->
    <script>
        Vue.component('chart',{
            extends:VueChartJs.Pie,
            data(){
                return{
                    votesOptions:[],
                    votesValue:[],
                    bgColor:[]
                }
            },
            mounted(){
                this.loadData()
                this.renderChart({
                    labels: this.votesOptions,
                    datasets: [
                        {
                            label: 'GRAFICOS',
                            backgroundColor: this.bgColor,
                            data: this.votesValue
                        }
                    ]
                },{responsive:true,  maintainAspectRatio: false})
            },
            methods:{
                loadData(){
                    (voting.postproc).forEach(element =>{
                        console.log(element.option)
                        randomColor = Math.floor(Math.random()*16777215).toString(16);
                        this.bgColor.push("#" + randomColor)
                        this.votesOptions.push(element.option)
                        this.votesValue.push(element.votes)
                    });
                }
            }

        })

        var voting = {{voting|safe}};
        var app = new Vue({
            delimiters: ['[[', ']]'],
            el: '#app-visualizer',
            data: {
                voting: voting
                
            }
        })
    </script>

    
</body>
{% endblock %}